## –ú–∞–∫—Ä–æ—Å—ã ü™Ñ

–ú—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –º–∞–∫—Ä–æ—Å—ã —Ç–∏–ø–∞ `println!` –≤—Å—é –∫–Ω–∏–≥—É, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–¥—É–º—ã–≤–∞–ª–∏—Å—å: –∞ –∫–∞–∫ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç?
–ú–∞–∫—Ä–æ—Å ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è. –≠—Ç–æ **–º–µ—Ç–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ**. –≠—Ç–æ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø–∏—à–µ—Ç –¥—Ä—É–≥–æ–π –∫–æ–¥.

–í Rust –µ—Å—Ç—å –¥–≤–∞ –≤–∏–¥–∞ –º–∞–∫—Ä–æ—Å–æ–≤, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö —É –≤–∞—Å –º–æ–∂–µ—Ç –≤–∑–æ—Ä–≤–∞—Ç—å—Å—è –º–æ–∑–≥ (–Ω–æ –≤ —Ö–æ—Ä–æ—à–µ–º —Å–º—ã—Å–ª–µ):

1. **–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ** (`macro_rules!`): —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ match-–≤—ã—Ä–∞–∂–µ–Ω–∏—è, –Ω–æ –¥–ª—è –∫–æ–¥–∞.
2. **–ü—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–µ**: –∫–∞—Å—Ç–æ–º–Ω—ã–µ `#[derive]`, –∞—Ç—Ä–∏–±—É—Ç—ã –∏ –ø—Ä–æ—á–∞—è —á–µ—Ä–Ω–∞—è –º–∞–≥–∏—è.

### –ó–∞—á–µ–º —É—Å–ª–æ–∂–Ω—è—Ç—å? ü§î

–ü–æ—á–µ–º—É –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏?

1. –§—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤. –ú–∞–∫—Ä–æ—Å—ã –º–æ–≥—É—Ç —Å—ä–µ—Å—Ç—å —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ (`println!("hello", "world", "!!!")`).
2. –ú–∞–∫—Ä–æ—Å—ã —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è **–¥–æ** –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –º–∞–∫—Ä–æ—Å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ç—Ä–µ–π—Ç–∞ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –∞ —Ñ—É–Ω–∫—Ü–∏—è ‚Äî –Ω–µ—Ç (–æ–Ω–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ä–∞–Ω—Ç–∞–π–º–µ).

–ù–æ –µ—Å—Ç—å –∏ –º–∏–Ω—É—Å: –ø–∏—Å–∞—Ç—å –º–∞–∫—Ä–æ—Å—ã —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º —á–∏—Ç–∞—Ç—å –î–æ—Å—Ç–æ–µ–≤—Å–∫–æ–≥–æ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ –±–µ–∑ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏.

### –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã (`macro_rules!`)

–≠—Ç–æ —Å–∞–º—ã–π —á–∞—Å—Ç—ã–π –∑–≤–µ—Ä—å. –í—Å–ø–æ–º–Ω–∏—Ç–µ `vec!`.

```rust
let v: Vec<u32> = vec![1, 2, 3];
```

–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç? –í–æ—Ç —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è:

<Listing number="20-35" file-name="src/lib.rs" caption="–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π vec!">

```rust,noplayground
{{#rustdoc_include ../listings/ch20-advanced-features/listing-20-35/src/lib.rs}}
```

</Listing>

–í–∑–≥–ª—è–Ω–∏—Ç–µ –Ω–∞ `( $( $x:expr ),* )`. –≠—Ç–æ –Ω–µ —Ä—É–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ –Ω–∞ –∏–Ω–æ–ø–ª–∞–Ω–µ—Ç–Ω–æ–º —è–∑—ã–∫–µ.

- `$()` ‚Äî –∑–∞—Ö–≤–∞—Ç –≥—Ä—É–ø–ø—ã.
- `$x:expr` ‚Äî –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –ª—é–±–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ Rust –∏ –Ω–∞–∑–≤–∞—Ç—å –µ–≥–æ `$x`.
- `,*` ‚Äî —ç—Ç–∏ –≥—Ä—É–ø–ø—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –∑–∞–ø—è—Ç—ã–º–∏ –∏ –º–æ–≥—É—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è –Ω–æ–ª—å –∏–ª–∏ –±–æ–ª–µ–µ —Ä–∞–∑.

–ö–æ–≥–¥–∞ –≤—ã –ø–∏—à–µ—Ç–µ `vec![1, 2, 3]`, –º–∞–∫—Ä–æ—Å –≤–∏–¥–∏—Ç —Ç—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –¥–ª—è `$x`. –ò –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–¥:
```rust
{
    let mut temp_vec = Vec::new();
    temp_vec.push(1);
    temp_vec.push(2);
    temp_vec.push(3);
    temp_vec
}
```

–ú–∞–≥–∏—è? –ú–∞–≥–∏—è.

### –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã üßô‚Äç‚ôÇÔ∏è

–ï—Å–ª–∏ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã ‚Äî —ç—Ç–æ match, —Ç–æ –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –∫–æ–¥ –Ω–∞ –≤—Ö–æ–¥ –∏ –≤—ã–ø–ª–µ–≤—ã–≤–∞—é—Ç –Ω–æ–≤—ã–π –∫–æ–¥ –Ω–∞ –≤—ã—Ö–æ–¥.
–¢—É—Ç –≤–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –∫—Ä–µ–π—Ç—ã `syn` (—á—Ç–æ–±—ã –ø–∞—Ä—Å–∏—Ç—å –∫–æ–¥) –∏ `quote` (—á—Ç–æ–±—ã –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥).

#### Custom `derive`

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–∏—Å–∞—Ç—å `#[derive(HelloMacro)]` –∏ —á—Ç–æ–±—ã –≤–∞—à–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∞–º–∞ —É—á–∏–ª–∞—Å—å –∑–¥–æ—Ä–æ–≤–∞—Ç—å—Å—è.

1. –°–æ–∑–¥–∞–µ–º –∫—Ä–µ–π—Ç `hello_macro`.
2. –°–æ–∑–¥–∞–µ–º –∫—Ä–µ–π—Ç `hello_macro_derive` (–¥–∞, –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –∂–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ).

–í `hello_macro_derive` –±—É–¥–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–∞—Ä—Å–∏—Ç –≤–∞—à—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É, —É–∑–Ω–∞–µ—Ç, —á—Ç–æ –µ–µ –∑–æ–≤—É—Ç `Pancakes`, –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `impl HelloMacro for Pancakes`.

<Listing number="20-42" file-name="hello_macro_derive/src/lib.rs" caption="–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ —Å –ø–æ–º–æ—â—å—é quote!">

```rust,ignore
{{#rustdoc_include ../listings/ch20-advanced-features/listing-20-42/hello_macro/hello_macro_derive/src/lib.rs:here}}
```

</Listing>

`quote!` –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å –∫–æ–¥ —à–∞–±–ª–æ–Ω–∞–º–∏, –ø–æ–¥—Å—Ç–∞–≤–ª—è—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `#name`. –≠—Ç–æ —Å—É–ø–µ—Ä-–º–æ—â–Ω–æ.

#### –ê—Ç—Ä–∏–±—É—Ç—ã –∏ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã

- **–ê—Ç—Ä–∏–±—É—Ç—ã**: `#[route(GET, "/")]`. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞—Ö.
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ**: `sql!(SELECT * FROM posts)`. –í—ã–≥–ª—è–¥—è—Ç –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–æ –º–æ–≥—É—Ç –¥–µ–ª–∞—Ç—å –≤—Å—ë —á—Ç–æ —É–≥–æ–¥–Ω–æ —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –≤–Ω—É—Ç—Ä–∏.

### –ò—Ç–æ–≥–∏

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å —Å—É–ø–µ—Ä—Å–∏–ª–∞. –í—ã –º–æ–∂–µ—Ç–µ –∑–∞—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø–∏—Å–∞—Ç—å –∫–æ–¥ –∑–∞ –≤–∞—Å. –ù–æ –ø–æ–º–Ω–∏—Ç–µ: —Å –≤–µ–ª–∏–∫–æ–π —Å–∏–ª–æ–π –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤–µ–ª–∏–∫–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å (–∏ –¥–æ–ª–≥–∏–µ —á–∞—Å—ã, –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–µ –≤ –ø–æ–ø—ã—Ç–∫–∞—Ö –ø–æ–Ω—è—Ç—å –æ—à–∏–±–∫—É –º–∞–∫—Ä–æ—Å–∞).

–ú—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏ –æ–±–∑–æ—Ä –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —Ñ–∏—á! –¢–µ–ø–µ—Ä—å –≤—ã –≥–æ—Ç–æ–≤—ã –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –±–∏—Ç–≤–µ ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—é –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞!

---

**–ê–Ω–µ–∫–¥–æ—Ç:**

> ‚Äî –ü–∞–ø–∞, –∞ –æ—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è –º–∞–∫—Ä–æ—Å—ã?  
> ‚Äî –ù—É, —Å—ã–Ω–æ–∫, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –æ—á–µ–Ω—å –ª—é–±–∏—Ç —Å–≤–æ–π –∫–æ–¥, –æ–Ω –ø–∏—à–µ—Ç `macro_rules!`, –∏ —Ç–æ–≥–¥–∞...  
> ‚Äî –ê –ø—Ä–∞–≤–¥–∞, —á—Ç–æ –º–∞–∫—Ä–æ—Å –º–æ–∂–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ 1000 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞?  
> ‚Äî –ü—Ä–∞–≤–¥–∞, —Å—ã–Ω–æ–∫. –ü–æ—ç—Ç–æ–º—É –º—ã –∏ –Ω–µ —Å–º–æ—Ç—Ä–∏–º –Ω–∞ `cargo expand` –Ω–∞ –Ω–æ—á—å.

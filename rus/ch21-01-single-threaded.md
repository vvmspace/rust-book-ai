## –û–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä. –ü–æ–≥–Ω–∞–ª–∏! üöÄ

–î–∞–≤–∞–π—Ç–µ-–∫–∞ —Å–æ–±–µ—Ä–µ–º —á—Ç–æ-–Ω–∏–±—É–¥—å —Ä–∞–±–æ—á–µ–µ. –ù–∞—á–Ω–µ–º —Å –ø—Ä–æ—Å—Ç–æ–≥–æ: –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä. –ù–∏–∫–∞–∫–∏—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤. –¢–æ–ª—å–∫–æ –≤—ã, Rust –∏ –≥–æ–ª—ã–π TCP.

### –õ–∏–∫–±–µ–∑ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º üìö

- **TCP** (Transmission Control Protocol): –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Ç—Ä—É–±–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –±–µ–≥–∞—é—Ç –±–∞–π—Ç—ã. –û–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –±–∞–π—Ç—ã –¥–æ–±–µ–≥—É—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.
- **HTTP** (Hypertext Transfer Protocol): —è–∑—ã–∫, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –æ–±—â–∞—é—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä –∏ —Å–µ—Ä–≤–µ—Ä –ø–æ–≤–µ—Ä—Ö —ç—Ç–æ–π —Ç—Ä—É–±—ã.

–ú—ã –±—É–¥–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å *—Å—ã—Ä—ã–º–∏* –¥–∞–Ω–Ω—ã–º–∏. –•–∞—Ä–¥–∫–æ—Ä.

### –°–ª—É—à–∞–µ–º —ç—Ñ–∏—Ä üéß

–ù–∞–º –Ω—É–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —É—à–∏ –∏ —Å–ª—É—à–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –í Rust –¥–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å `std::net::TcpListener`.

–°–æ–∑–¥–∞–µ–º –ø—Ä–æ–µ–∫—Ç:
```console
$ cargo new hello
$ cd hello
```

–ò –ø–∏—à–µ–º –∫–æ–¥, —á—Ç–æ–±—ã —Å–ª—É—à–∞—Ç—å –ø–æ—Ä—Ç `7878` (–ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ `rust` –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ üòâ).

<Listing number="21-1" file-name="src/main.rs" caption="–°–ª—É—à–∞–µ–º –ø–æ—Ä—Ç –∏ —Ä–∞–¥—É–µ–º—Å—è –≤—Ö–æ–¥—è—â–∏–º">

```rust,no_run
{{#rustdoc_include ../listings/ch21-web-server/listing-21-01/src/main.rs}}
```

</Listing>

–ó–∞–ø—É—Å–∫–∞–µ–º `cargo run` –∏ –∏–¥–µ–º –≤ –±—Ä–∞—É–∑–µ—Ä –ø–æ –∞–¥—Ä–µ—Å—É `127.0.0.1:7878`. –ë—Ä–∞—É–∑–µ—Ä —Å–∫–∞–∂–µ—Ç "–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è" (–ø–æ—Ç–æ–º—É —á—Ç–æ –º—ã –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª–∏), –Ω–æ –≤ –∫–æ–Ω—Å–æ–ª–∏ –≤—ã —É–≤–∏–¥–∏—Ç–µ: `Connection established!`.

–ï—Å—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç!

### –ß–∏—Ç–∞–µ–º –º—ã—Å–ª–∏ (–∑–∞–ø—Ä–æ—Å) –±—Ä–∞—É–∑–µ—Ä–∞ üîÆ

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ —É–∑–Ω–∞–µ–º, —á–µ–≥–æ —Ö–æ—á–µ—Ç –∫–ª–∏–µ–Ω—Ç. –ù–∞–º –Ω—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ—Ç–æ–∫–∞ (`TcpStream`).

<Listing number="21-2" file-name="src/main.rs" caption="–ß–∏—Ç–∞–µ–º –ø–æ—Ç–æ–∫ —á–µ—Ä–µ–∑ BufReader">

```rust,no_run
{{#rustdoc_include ../listings/ch21-web-server/listing-21-02/src/main.rs}}
```

</Listing>

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `BufReader` –∏ –µ–≥–æ –º–µ—Ç–æ–¥ `lines()`. –ú—ã —á–∏—Ç–∞–µ–º, –ø–æ–∫–∞ –Ω–µ –≤—Å—Ç—Ä–µ—Ç–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É. –ü–æ—á–µ–º—É? –ü–æ—Ç–æ–º—É —á—Ç–æ HTTP-–∑–∞–ø—Ä–æ—Å –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –¥–≤–æ–π–Ω—ã–º –ø–µ—Ä–µ–Ω–æ—Å–æ–º —Å—Ç—Ä–æ–∫–∏ (`\r\n\r\n`).

–†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–π:
```
Request: [
    "GET / HTTP/1.1",
    "Host: 127.0.0.1:7878",
    ...
]
```

–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ. `GET / HTTP/1.1`. –ú–µ—Ç–æ–¥, –ø—É—Ç—å, –≤–µ—Ä—Å–∏—è.

### –ü–∏—à–µ–º –æ—Ç–≤–µ—Ç ‚úçÔ∏è

–ö–ª–∏–µ–Ω—Ç —Å–ø—Ä–æ—Å–∏–ª ‚Äî –Ω–∞–¥–æ –æ—Ç–≤–µ—Ç–∏—Ç—å. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ —Ç–∞–∫–æ–π:
`HTTP-Version Status-Code Reason-Phrase CRLF headers CRLF message-body`

–ù–∞–ø—Ä–∏–º–µ—Ä:
`HTTP/1.1 200 OK\r\n\r\n`

–î–∞–≤–∞–π—Ç–µ –ø–æ—à–ª–µ–º —ç—Ç–æ –∫–ª–∏–µ–Ω—Ç—É.

<Listing number="21-3" file-name="src/main.rs" caption="–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫—Ä–æ—à–µ—á–Ω—ã–π —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç">

```rust,no_run
{{#rustdoc_include ../listings/ch21-web-server/listing-21-03/src/main.rs:here}}
```

</Listing>

–¢–µ–ø–µ—Ä—å –±—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∂–µ—Ç –ø—É—Å—Ç—É—é –±–µ–ª—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, –∞ –Ω–µ –æ—à–∏–±–∫—É. –ü—Ä–æ–≥—Ä–µ—Å—Å!

### –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π HTML üìÑ

–î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª `hello.html` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (—Ä—è–¥–æ–º —Å `src`, –∞ –Ω–µ –≤–Ω—É—Ç—Ä–∏).

<Listing number="21-4" file-name="hello.html" caption="hello.html">

```html
{{#include ../listings/ch21-web-server/listing-21-05/hello.html}}
```

</Listing>

–ò –Ω–∞—É—á–∏–º —Å–µ—Ä–≤–µ—Ä —á–∏—Ç–∞—Ç—å –µ–≥–æ –∏ –æ—Ç–¥–∞–≤–∞—Ç—å.

<Listing number="21-5" file-name="src/main.rs" caption="–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞">

```rust,no_run
{{#rustdoc_include ../listings/ch21-web-server/listing-21-05/src/main.rs:here}}
```

</Listing>

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Content-Length`, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä –∑–Ω–∞–ª, —Å–∫–æ–ª—å–∫–æ —á–∏—Ç–∞—Ç—å.

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ 404 üö´

–°–µ–π—á–∞—Å –Ω–∞—à —Å–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞–µ—Ç `hello.html` –Ω–∞ –ª—é–±–æ–π –∑–∞–ø—Ä–æ—Å. –•–æ—Ç—å `/foo`, —Ö–æ—Ç—å `/bar`.
–î–∞–≤–∞–π—Ç–µ –±—É–¥–µ–º –≤–µ–∂–ª–∏–≤—ã–º–∏, –Ω–æ —Å—Ç—Ä–æ–≥–∏–º–∏. –ï—Å–ª–∏ –ø—Ä–æ—Å—è—Ç `/` -> –¥–µ—Ä–∂–∏ `hello.html`. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ -> 404.

<Listing number="21-6" file-name="src/main.rs" caption="–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞">

```rust,no_run
{{#rustdoc_include ../listings/ch21-web-server/listing-21-06/src/main.rs:here}}
```

</Listing>

–ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–ª–æ ‚Äî –æ—Ç–¥–∞–µ–º `404.html`.

<Listing number="21-7" file-name="src/main.rs" caption="–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ 404">

```rust,no_run
{{#rustdoc_include ../listings/ch21-web-server/listing-21-07/src/main.rs:here}}
```

</Listing>

### –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: —É–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ üßπ

–ö–æ–¥ —Å—Ç–∞–ª –Ω–µ–º–Ω–æ–≥–æ –≥—Ä—è–∑–Ω—ã–º. –ú–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π. –î–∞–≤–∞–π—Ç–µ –≤—ã–Ω–µ—Å–µ–º —Ä–∞–∑–ª–∏—á–∏—è (—Å—Ç–∞—Ç—É—Å –∏ –∏–º—è —Ñ–∞–π–ª–∞) –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.

<Listing number="21-9" file-name="src/main.rs" caption="–ö—Ä–∞—Å–∏–≤—ã–π –∏ —á–∏—Å—Ç—ã–π –∫–æ–¥">

```rust,no_run
{{#rustdoc_include ../listings/ch21-web-server/listing-21-09/src/main.rs:here}}
```

</Listing>

–í–æ—Ç —Ç–µ–ø–µ—Ä—å —É –Ω–∞—Å –Ω–∞—Å—Ç–æ—è—â–∏–π, (–ø–æ—á—Ç–∏) –≤–∑—Ä–æ—Å–ª—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –Ω–∞ 40 —Å—Ç—Ä–æ–∫–∞—Ö Rust!
–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî –æ–Ω –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω—ã–π. –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ "–∑–∞–≤–∏—Å–Ω–µ—Ç" –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ, –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –±—É–¥—É—Ç –∂–¥–∞—Ç—å.
–ù–æ —ç—Ç–æ –º—ã –ø–æ—á–∏–Ω–∏–º –≤ —Å–ª–µ–¥—É—é—â–µ–π –≥–ª–∞–≤–µ!

---

**–ê–Ω–µ–∫–¥–æ—Ç:**

> –ö–ª–∏–µ–Ω—Ç: GET /vodka HTTP/1.1
> –°–µ—Ä–≤–µ—Ä: 402 Payment Required
> –ö–ª–∏–µ–Ω—Ç: GET /beer HTTP/1.1
> –°–µ—Ä–≤–µ—Ä: 418 I'm a teapot

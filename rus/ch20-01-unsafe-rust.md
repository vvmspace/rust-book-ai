## Unsafe Rust: –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –æ–ø–∞—Å–Ω—É—é –∑–æ–Ω—É ‚ò¢Ô∏è

–î–æ —Å–∏—Ö –ø–æ—Ä –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –¥–µ—Ä–∂–∞–ª –Ω–∞—Å –∑–∞ —Ä—É–∫—É –∏ –Ω–µ –¥–∞–≤–∞–ª —É–ø–∞—Å—Ç—å. –û—Ç–±–∏—Ä–∞–ª —Å–ø–∏—á–∫–∏, –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–ª –∑–∞—Å–æ–≤—ã–≤–∞—Ç—å –ø–∞–ª—å—Ü—ã –≤ —Ä–æ–∑–µ—Ç–∫—É.
–ü—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –ø–æ–≤–∑—Ä–æ—Å–ª–µ—Ç—å.
**Unsafe Rust** ‚Äî —ç—Ç–æ —Ä–µ–∂–∏–º –±–æ–≥–∞. –ò–ª–∏ —Ä–µ–∂–∏–º –¥—É—Ä–∞–∫–∞. –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–∞—Å.

### –ü—è—Ç—å —Å—É–ø–µ—Ä—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π ü¶∏‚Äç‚ôÇÔ∏è

–í–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ `unsafe { ... }` –≤—ã –º–æ–∂–µ—Ç–µ –¥–µ–ª–∞—Ç—å –ø—è—Ç—å –≤–µ—â–µ–π, –∑–∞ –∫–æ—Ç–æ—Ä—ã–µ –≤ –æ–±—ã—á–Ω–æ–º Rust –≤–∞—Å –±—ã –∑–∞–±–∞–Ω–∏–ª–∏:

1. –†–∞–∑—ã–º–µ–Ω–æ–≤—ã–≤–∞—Ç—å —Å—ã—Ä—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ (raw pointers).
2. –í—ã–∑—ã–≤–∞—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (`unsafe fn`).
3. –ò–∑–º–µ–Ω—è—Ç—å –º—É—Ç–∞–±–µ–ª—å–Ω—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`static mut`).
4. –†–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç—Ä–µ–π—Ç—ã (`unsafe trait`).
5. –ß–∏—Ç–∞—Ç—å –ø–æ–ª—è `union`.

`unsafe` –Ω–µ –æ—Ç–∫–ª—é—á–∞–µ—Ç borrow checker! –û–Ω –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —ç—Ç–∏ 5 –¥–µ–π—Å—Ç–≤–∏–π.

### –°—ã—Ä—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏: C-—Å—Ç–∞–π–ª –≤ Rust ‚ò†Ô∏è

`*const T` –∏ `*mut T`.
–û–Ω–∏ –º–æ–≥—É—Ç:

- –ë—ã—Ç—å null.
- –£–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω—É—é –ø–∞–º—è—Ç—å.
- –°–æ–∑–¥–∞–≤–∞—Ç—å –≥–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤–ª–∞–¥–µ–Ω–∏—è.

```rust
let mut num = 5;
let r1 = &raw const num;
let r2 = &raw mut num;

unsafe {
    println!("r1 is: {}", *r1);
    println!("r2 is: {}", *r2);
}
```

–°–æ–∑–¥–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å –º–æ–∂–Ω–æ –∏ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –∫–æ–¥–µ. –ê –≤–æ—Ç *—Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞—Ç—å* (–ø—Ä–æ—á–∏—Ç–∞—Ç—å/–∑–∞–ø–∏—Å–∞—Ç—å) ‚Äî —Ç–æ–ª—å–∫–æ –≤ `unsafe`.

### –í—ã–∑–æ–≤ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

```rust
unsafe fn dangerous() {}

unsafe {
    dangerous();
}
```

–ö–æ–≥–¥–∞ –≤—ã –ø–∏—à–µ—Ç–µ `unsafe`, –≤—ã –≥–æ–≤–æ—Ä–∏—Ç–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É: "–Ø –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∏–ª. –ú–∞–º–æ–π –∫–ª—è–Ω—É—Å—å. –ó–¥–µ—Å—å –≤—Å–µ –∑–∞–∫–æ–Ω–Ω–æ".
–ï—Å–ª–∏ –≤—ã —Å–æ–≤—Ä–∞–ª–∏... Segfault. Undefined Behavior. –í–∑—Ä—ã–≤ –Ω–∞ –º–∞–∫–∞—Ä–æ–Ω–Ω–æ–π —Ñ–∞–±—Ä–∏–∫–µ.

–ß–∞—Å—Ç–æ `unsafe` –∫–æ–¥ –æ–±–æ—Ä–∞—á–∏–≤–∞—é—Ç –≤ –±–µ–∑–æ–ø–∞—Å–Ω—É—é –æ–±–µ—Ä—Ç–∫—É. –ü—Ä–∏–º–µ—Ä: `split_at_mut` –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏. –í–Ω—É—Ç—Ä–∏ —Ç–∞–º –∞–¥ –∏ –ø–æ–≥–∏–±–µ–ª—å —Å —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏, –Ω–æ —Å–Ω–∞—Ä—É–∂–∏ ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

### FFI: –û–±—â–µ–Ω–∏–µ —Å –ø—Ä–∏—à–µ–ª—å—Ü–∞–º–∏ üëΩ

–•–æ—Ç–∏—Ç–µ –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ C? –í–∞–º –Ω—É–∂–µ–Ω `extern` –∏ `unsafe`.

```rust
extern "C" {
    fn abs(input: i32) -> i32;
}

fn main() {
    unsafe {
        println!("Absolute value of -3 according to C: {}", abs(-3));
    }
}
```

### Miri: –í–∞—à –∞–Ω–≥–µ–ª-—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å üëº

–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—ã –Ω–µ –Ω–∞–ª–∞–∂–∞–ª–∏ –≤ `unsafe`?
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Miri**. –≠—Ç–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤–∞—à –∫–æ–¥ –∏ –æ—Ä–µ—Ç, –µ—Å–ª–∏ –≤–∏–¥–∏—Ç Undefined Behavior.
`cargo +nightly miri test`

### –ò—Ç–æ–≥–∏

Unsafe Rust –Ω—É–∂–µ–Ω –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, FFI –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫. –ò –≤—Å–µ–≥–¥–∞ (–í–°–ï–ì–î–ê) –ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π `// SAFETY: ...`, –æ–±—ä—è—Å–Ω—è—è, –ø–æ—á–µ–º—É —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ.

---

**–ê–Ω–µ–∫–¥–æ—Ç:**

> –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –Ω–∞ C++ –∑–∞—Ö–æ–¥–∏—Ç –≤ –±–∞—Ä Unsafe Rust.  
> ‚Äî –ú–Ω–µ –±–æ–∫–∞–ª Undefined Behavior.
> –ë–∞—Ä–º–µ–Ω –Ω–∞–ª–∏–≤–∞–µ—Ç –≤–æ–¥—É. –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –≤—ã–ø–∏–≤–∞–µ—Ç –∏ —É–º–∏—Ä–∞–µ—Ç.
> –ë–∞—Ä–º–µ–Ω:  
> ‚Äî –°—Ç—Ä–∞–Ω–Ω–æ, –≤—á–µ—Ä–∞ —ç—Ç–æ –±—ã–ª–æ –ø–∏–≤–æ.
